@startuml
Client-> Server: UseMarket()
activate Server

alt tryAdd() == true
    Client<-- Server: AnswerUseMarket()  
else tryAdd() == false
        loop until tryAdd() == true
            Client<- Server: RequestDiscardResourceMarket()

            Client-> Server: DiscardResourceMarket()

            Server-> GameHandler: DiscardResource()
             activate GameHandler

            GameHandler-> Controller: DiscardResource()
            activate Controller 

            Controller-> GameTable: DiscardResourceFromTemporaryDeposit()
            deactivate Controller

            Server<-- GameHandler: AnswerUseMarket()
             deactivate GameHandler

            Client<-- Server: AnswerUseMarket()


        end

deactivate Server


end
@enduml
