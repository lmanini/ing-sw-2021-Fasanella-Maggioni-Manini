@startuml
Client-> Server: UseMarket()


alt tryAddMarbles() == true
            Server-> GameHandler: ??()
             activate GameHandler

            GameHandler-> Controller: ??()
            activate Controller 
            activate GameTable
            Controller-> GameTable: tryAddMarbles()
            Controller<- GameTable: true
             deactivate GameTable
            Controller -> GameHandler: true
            deactivate Controller
            

else tryAdd() == false
        loop until tryAdd() == true
            Server-> GameHandler: ??()


            GameHandler-> Controller: ??()

            activate GameTable
            Controller-> GameTable: tryAddMarbles()
            Controller<- GameTable: false
            deactivate GameTable           
      
            Controller -> GameHandler: false

            GameHandler->Server: RequestDiscardResourceMarket()
            Client<- Server: RequestDiscardResourceMarket()

            Client-> Server: DiscardResourceMarket()

            Server-> GameHandler: DiscardResource()


            GameHandler-> Controller: DiscardResource()


            Controller-> GameTable: DiscardResourceFromTemporaryDeposit()



        end
            Server<-- GameHandler: AnswerUseMarket()
           
            deactivate GameHandler

            Client<-- Server: AnswerUseMarket() 


end
@enduml